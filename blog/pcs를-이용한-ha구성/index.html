<!DOCTYPE html>
<html lang="en-us">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="chrome=1">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer">
<meta name="author" content="Yoan">
<meta name="description" content="pcs: pacemaker/corosync ì„¤ì •,ê´€ë¦¬ ì‹œìŠ¤í…œ
 pacemaker: ê³ ê°€ìš©ì„± í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ì (ê³ ì¥ì„ ì¸ì§€í•œ ê²½ìš° ëŒ€ê¸°ì¥ë¹„ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë„˜ê¹ë‹ˆë‹¤.- failover)
corosync: ê·¸ë£¹ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ HAê¸°ëŠ¥ API ì œê³µ (node status)
 pcsë¥¼ ì´ìš©í•˜ì—¬ ë‘ëŒ€ì˜ ì„œë²„ë¥¼ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¡œ ë¬¶ì–´ HAë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
ë§ˆìŠ¤í„° ì„œë²„ ì¥ì• ì‹œ ìŠ¤íƒ ë°”ì´ ì¥ë¹„ê°€ ë§ˆìŠ¤í„°ë¡œ ìŠ¹ê³„ë©ë‹ˆë‹¤.
ë‘ëŒ€ ì„œë²„ ëª¨ë‘ ë™ì¼í•œ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ ë¬¸ì„œì—ì„œëŠ” ë‹¨ìˆœ ë™ê¸°í™” ë°©ì‹ì´ ì•„ë‹Œ drbdë¥¼ êµ¬ì„± í•  ì˜ˆì •ì…ë‹ˆë‹¤.
 drbd: HA í´ëŸ¬ìŠ¤í„°ë¥¼ ìœ„í•´ ë””ìì¸ ëœ ë„¤íŠ¸ì›Œí¬ ë¸”ëŸ­ ë””ë°”ì´ìŠ¤">

<meta property="og:title" content="PCSë¥¼ ì´ìš©í•œ HAêµ¬ì„±" />
<meta property="og:description" content="pcs: pacemaker/corosync ì„¤ì •,ê´€ë¦¬ ì‹œìŠ¤í…œ
 pacemaker: ê³ ê°€ìš©ì„± í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ì (ê³ ì¥ì„ ì¸ì§€í•œ ê²½ìš° ëŒ€ê¸°ì¥ë¹„ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë„˜ê¹ë‹ˆë‹¤.- failover)
corosync: ê·¸ë£¹ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ HAê¸°ëŠ¥ API ì œê³µ (node status)
 pcsë¥¼ ì´ìš©í•˜ì—¬ ë‘ëŒ€ì˜ ì„œë²„ë¥¼ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¡œ ë¬¶ì–´ HAë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
ë§ˆìŠ¤í„° ì„œë²„ ì¥ì• ì‹œ ìŠ¤íƒ ë°”ì´ ì¥ë¹„ê°€ ë§ˆìŠ¤í„°ë¡œ ìŠ¹ê³„ë©ë‹ˆë‹¤.
ë‘ëŒ€ ì„œë²„ ëª¨ë‘ ë™ì¼í•œ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ ë¬¸ì„œì—ì„œëŠ” ë‹¨ìˆœ ë™ê¸°í™” ë°©ì‹ì´ ì•„ë‹Œ drbdë¥¼ êµ¬ì„± í•  ì˜ˆì •ì…ë‹ˆë‹¤.
 drbd: HA í´ëŸ¬ìŠ¤í„°ë¥¼ ìœ„í•´ ë””ìì¸ ëœ ë„¤íŠ¸ì›Œí¬ ë¸”ëŸ­ ë””ë°”ì´ìŠ¤" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://yoanp.github.io/blog/pcs%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-ha%EA%B5%AC%EC%84%B1/" />
<meta property="article:published_time" content="2017-03-04T13:45:07+09:00" />
<meta property="article:modified_time" content="2017-03-04T13:45:07+09:00" />


<title>


     PCSë¥¼ ì´ìš©í•œ HAêµ¬ì„± 

</title>
<link rel="canonical" href="https://yoanp.github.io/blog/pcs%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-ha%EA%B5%AC%EC%84%B1/">







<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/styles/default.min.css">




<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+Serif+KR:400,700|Open+Sans:400,700|Ubuntu+Mono:400,400i,700,700i|Raleway:500">



    
    <link rel="stylesheet" href="https://yoanp.github.io/css/reset.css?t=2019-08-16%2014%3a13%3a11.829351%20%2b0900%20KST%20m%3d%2b0.074183880">
    <link rel="stylesheet" href="https://yoanp.github.io/css/pygments.css?t=2019-08-16%2014%3a13%3a11.829351%20%2b0900%20KST%20m%3d%2b0.074183880">
    <link rel="stylesheet" href="https://yoanp.github.io/css/main.css?t=2019-08-16%2014%3a13%3a11.829351%20%2b0900%20KST%20m%3d%2b0.074183880">
    
        <link rel="stylesheet" href="https://yoanp.github.io/css/override.css?t=2019-08-16%2014%3a13%3a11.829351%20%2b0900%20KST%20m%3d%2b0.074183880">
    




<link rel="shortcut icon"

    href="https://yoanp.github.io/img/leaf.ico"

>








</head>


<body lang="en">

<section class="header">
    <div class="container">
        <div class="content">
            
            <a href="https://yoanp.github.io/"><div class="name">Yoan</div></a>
            
            <nav>
                <ul>
                    
                        <li class="nav-blog"><a href="https://yoanp.github.io/blog/"><span>Blog</span></a></li>
                    
                        <li class="nav-about"><a href="https://yoanp.github.io/about/"><span>About</span></a></li>
                    
                        <li class="nav-tags"><a href="https://yoanp.github.io/tags/"><span>Tags</span></a></li>
                    
                </ul>
            </nav>
        </div>
    </div>
</section>

<section class="icons">
    <div class="container">
        <div class="content">
        
            <a href="//github.com/yoanp" target="_blank" rel="noopener"><img class="icon" src="https://yoanp.github.io/img/github.svg" alt="github" /></a>
        

        

        
            <a href="//twitter.com/crosoie" target="_blank" rel="noopener"><img class="icon" src="https://yoanp.github.io/img/twitter.svg" alt="twitter" /></a>
        

	

        

        

        

        

        

        

        

        

        
            <a href="mailto:crosoie@gmail.com"><img class="icon" src="https://yoanp.github.io/img/email.svg" alt="email" /></a>
        

        

        
        </div>
    </div>
</section>


<section class="main post non-narrow zero-top-spacing">
    <div class="container">
        <div class="content">
            <div class="front-matter">
                <div class="title-container">
                    <div class="page-heading">

    PCSë¥¼ ì´ìš©í•œ HAêµ¬ì„±

</div>

                    <div class="initials"><a href="https://yoanp.github.io"></a></div>
                </div>
                <div class="meta">
                    
                    <div class="date" title='Sat Mar 4 2017 13:45:07 KST'>Mar 4, 2017</div>
                    
                    
		    <div class="reading-time"><div class="middot"></div>6 minutes read</div>
                    
                </div>
            </div>
            <div class="markdown">
                

<p><code>pcs</code>: pacemaker/corosync ì„¤ì •,ê´€ë¦¬ ì‹œìŠ¤í…œ</p>

<blockquote>
<p><code>pacemaker</code>: ê³ ê°€ìš©ì„± í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ì (ê³ ì¥ì„ ì¸ì§€í•œ ê²½ìš° ëŒ€ê¸°ì¥ë¹„ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë„˜ê¹ë‹ˆë‹¤.- failover)<br />
<code>corosync</code>: ê·¸ë£¹ì»¤ë®¤ë‹ˆì¼€ì´ì…˜ ì‹œìŠ¤í…œì„ êµ¬í˜„í•˜ê¸° ìœ„í•œ HAê¸°ëŠ¥ API ì œê³µ (node status)</p>
</blockquote>

<p>pcsë¥¼ ì´ìš©í•˜ì—¬ ë‘ëŒ€ì˜ ì„œë²„ë¥¼ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¡œ ë¬¶ì–´ HAë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.<br />
ë§ˆìŠ¤í„° ì„œë²„ ì¥ì• ì‹œ ìŠ¤íƒ ë°”ì´ ì¥ë¹„ê°€ ë§ˆìŠ¤í„°ë¡œ ìŠ¹ê³„ë©ë‹ˆë‹¤.<br />
ë‘ëŒ€ ì„œë²„ ëª¨ë‘ ë™ì¼í•œ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ê³  ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì´ ë¬¸ì„œì—ì„œëŠ” ë‹¨ìˆœ ë™ê¸°í™” ë°©ì‹ì´ ì•„ë‹Œ drbdë¥¼ êµ¬ì„± í•  ì˜ˆì •ì…ë‹ˆë‹¤.</p>

<blockquote>
<p><code>drbd</code>: HA í´ëŸ¬ìŠ¤í„°ë¥¼ ìœ„í•´ ë””ìì¸ ëœ ë„¤íŠ¸ì›Œí¬ ë¸”ëŸ­ ë””ë°”ì´ìŠ¤</p>
</blockquote>

<h2 id="ê¸°ë³¸-ì •ë³´">ê¸°ë³¸ ì •ë³´</h2>

<blockquote>
<p>CentOS 7.3
pcs-0.9.152-10
pacemaker-1.1
corosync-2.4</p>
</blockquote>

<h2 id="ê¸°ë³¸-ì„¤ì •">ê¸°ë³¸ ì„¤ì •</h2>

<h3 id="í˜¸ìŠ¤íŠ¸-ì„¤ì •">í˜¸ìŠ¤íŠ¸ ì„¤ì •</h3>

<blockquote>
<p>ë‘ì„œë²„ ëª¨ë‘ ì ìš© í•´ ì£¼ì„¸ìš”.</p>
</blockquote>

<pre><code class="language-bash">root # cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
10.0.0.3 master
10.0.0.4 standby
</code></pre>

<h3 id="ë°©í™”ë²½-ì„¤ì •">ë°©í™”ë²½ ì„¤ì •</h3>

<p>ë‘ì„œë²„ê°€ ì„œë¡œ í†µì‹ ì´ ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.<br />
ì €ëŠ” ë‚´ë¶€ë§ì„ ALLë¡œ ì—´ì—ˆì–´ìš”â€¦</p>

<h2 id="drbd">DRBD</h2>

<h3 id="íŒ¨í‚¤ì§€-ì„¤ì¹˜">íŒ¨í‚¤ì§€ ì„¤ì¹˜</h3>

<p>DRBD íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì¤ë‹ˆë‹¤.</p>

<pre><code class="language-bash">root # cd /usr/local/src
root # wget http://elrepo.reloumirrors.net/elrepo/el7/x86_64/RPMS/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
root # rpm -ivh elrepo-release-7.0-2.el7.elrepo.noarch.rpm
root # yum -y install drbd kmod-drbd84 kernel-devel
</code></pre>

<h3 id="drbd-ì„¤ì •">DRBD ì„¤ì •</h3>

<p>global ì„¤ì • íŒŒì¼ì—ì„œ 18~20ì¤„ ì£¼ì„ì„ í•´ì œí•©ë‹ˆë‹¤.</p>

<h4 id="ë¦¬ì†ŒìŠ¤-íŒŒì¼ì„-ìƒì„±í•©ë‹ˆë‹¤">ë¦¬ì†ŒìŠ¤ íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤</h4>

<pre><code class="language-bash">root # vi /etc/drbd.d/storage.res
resource &quot;storage&quot; {
     protocol C;
     startup {
          wfc-timeout       0;      ## Infinite!
          degr-wfc-timeout  120;    ## 2 minutes.
     }
     disk {
        on-io-error detach;
        resync-rate 300M;
     }
    net {
        timeout             60;     #  6 seconds  (unit = 0.1 seconds)
        connect-int         10;     # 10 seconds  (unit = 1 second)
        ping-int            10;     # 10 seconds  (unit = 1 second)
        max-buffers         20000;
        unplug-watermark    20000;
        max-epoch-size      20000;
    }
     # It is valid to move device, disk and meta-disk to the
     # resource level.
    on master {
        device /dev/drbd0;
        disk /dev/sda5;
        address 10.0.0.3:7789;
        meta-disk internal;
    }
    on standby {
        device /dev/drbd0;
        disk /dev/sda5;
        address 10.0.0.3:7789;
        meta-disk internal;
    }
}
</code></pre>

<h3 id="drbd-ë¦¬ì†ŒìŠ¤-ìƒì„±">DRBD ë¦¬ì†ŒìŠ¤ ìƒì„±</h3>

<pre><code class="language-bash">root # drbdadm create-md storage
initializing activity log
NOT initializing bitmap
Writing meta data...
New drbd meta data block successfully created.
</code></pre>

<h3 id="drbd-êµ¬ë™-ë°-ë™ê¸°í™”">DRBD êµ¬ë™ ë° ë™ê¸°í™”</h3>

<p>ì‹¤í–‰!</p>

<pre><code class="language-bash">root # systemctl start drbd
</code></pre>

<h3 id="ë°ì´í„°-ë™ê¸°í™”ë¥¼-í•©ë‹ˆë‹¤">ë°ì´í„° ë™ê¸°í™”ë¥¼ í•©ë‹ˆë‹¤</h3>

<blockquote>
<p>MASTERì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤.</p>
</blockquote>

<pre><code class="language-bash">root # drbdadm -- --overwrite-data-of-peer primary storage
</code></pre>

<h2 id="ha-êµ¬ì„±">HA êµ¬ì„±</h2>

<h3 id="íŒ¨í‚¤ì§€-ì„¤ì¹˜-1">íŒ¨í‚¤ì§€ ì„¤ì¹˜</h3>

<p>ë‘ì„œë²„ ëª¨ë‘ ì ìš© í•´ ì£¼ì„¸ìš”.</p>

<pre><code class="language-bash">yum install -y corosync pacemaker pcs resource-agents
</code></pre>

<h3 id="pcsd-ì‹¤í–‰">pcsd ì‹¤í–‰</h3>

<p>ë‘ì„œë²„ ëª¨ë‘ ì ìš© í•´ ì£¼ì„¸ìš”.</p>

<pre><code class="language-bash">systemctl start pcsd.service
systemctl enable pcsd.service
systemctl enable corosync.service
systemctl enable pacemaker.service
</code></pre>

<h3 id="ì¸ì¦-ê³„ì •-ì ìš©">ì¸ì¦ ê³„ì • ì ìš©</h3>

<p>í•´ë‹¹ ì¸ì¦ ê³„ì • ì„¤ì •ì„ í†µí•˜ì—¬ í•œëŒ€ì˜ ì„œë²„ì—ì„œ í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•  ê²½ìš° ëª¨ë“  ì„œë²„ì— ë°˜ì˜ì´ ë©ë‹ˆë‹¤.</p>

<pre><code class="language-bash">root # passwd hacluster
hacluster ì‚¬ìš©ìì˜ ë¹„ë°€ ë²ˆí˜¸ ë³€ê²½ ì¤‘
ìƒˆ  ì•”í˜¸ :
root # pcs cluster auth master
Username: hacluster
Password: ********************
root # pcs cluster auth standby
Username: hacluster
Password: ********************
</code></pre>

<p>ì •ìƒì ìœ¼ë¡œ ì¸ì¦ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</p>

<pre><code class="language-bash">root # pcs cluster auth master standby
master: Already authorized
standby: Already authorized
</code></pre>

<h3 id="í´ëŸ¬ìŠ¤í„°-êµ¬ì„±">í´ëŸ¬ìŠ¤í„° êµ¬ì„±</h3>

<p><code>FileClusterë€</code> ì´ë¦„ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
í•´ë‹¹ í´ëŸ¬ìŠ¤í„°ì—” master/standby ë‘ëŒ€ì˜ ì„œë²„ê°€ í¬í•¨ë©ë‹ˆë‹¤.
ë°ì´í„° ì „ì†¡ì€ UDPí†µì‹ ì„ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</p>

<pre><code class="language-bash">root # pcs cluster setup --start --name FileCluster master standby --transport udpu
</code></pre>

<p>í”„ë¡œí¼í‹° ì„¤ì •ì„ ì¶”ê°€ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.</p>

<p><code>STONITH</code>: (Shoot The Head in The Head) ê°€ì§œ ë…¸ë“œ í˜¹ì€ ì˜ë„ì¹˜ ì•Šì€ ë™ì‹œ ì—‘ì„¸ìŠ¤ë¡œ ì¸í•œ ë°ì´í„° ì†ìƒì„ ë³´í˜¸í•©ë‹ˆë‹¤.
<code>no-quorum-policy</code>: í´ëŸ¬ìŠ¤í„°ì— quorumì´ ì—†ì„ ë•Œì˜ ìˆ˜í–‰ì‘ì—…ì„ ì„¤ì •í•©ë‹ˆë‹¤.
<code>resource-stickiness</code>: ì„œë¹„ìŠ¤ ì§€ì†ë ¥</p>

<pre><code class="language-bash">root # pcs property set stonith-enabled=false
root # pcs property set no-quorum-policy=ignore
root # pcs property set default-resource-stickiness=100
</code></pre>

<p>ì •ìƒì ìœ¼ë¡œ êµ¬ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤</p>

<pre><code class="language-bash">root # pcs status
Cluster name: FileCluster
Stack: corosync
Current DC: master (version 1.1.15-11.el7_3.2-e174ec8) - partition with quorum
Last updated: Fri Mar  3 14:47:29 2017		Last change: Fri Mar  3 23:27:16 2017 by hacluster via crmd on master
 
2 nodes and 0 resources configured
 
Online: [ master standby ]
 
No resources
 
 
Daemon Status:
  corosync: active/disabled
  pacemaker: active/disabled
  pcsd: active/enabled
</code></pre>

<h3 id="ë¦¬ì†ŒìŠ¤-ìƒì„±">ë¦¬ì†ŒìŠ¤ ìƒì„±</h3>

<p>failover ì„¤ì •ì´ í¬í•¨ë˜ë„ë¡ ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.</p>

<p>ìš°ì„  ë¦¬ì†ŒìŠ¤ ì—ì´ì „íŠ¸ì˜ ì¢…ë¥˜ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.</p>

<h4 id="heartbeat-resource-agents">Heartbeat Resource Agents</h4>

<p>ì˜ˆì „ì— ì‚¬ìš©í•˜ë˜ LSBë°©ì‹ì˜ init ìŠ¤í¬ë¦½íŠ¸ë¥¼ ëœ»í•©ë‹ˆë‹¤.</p>

<h4 id="lsb-resource-agents">LSB Resource Agents</h4>

<p>/etc/init.d ì•„ë˜ì— ì¡´ì¬í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ OS/ë°°í¬íŒì—ì„œ ì œê³µí•©ë‹ˆë‹¤.
í•˜ì§€ë§Œ <a href="http://refspecs.linux-foundation.org/LSB_3.2.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html">LSB ìŠ¤í™</a>ì„ ì¤€ìˆ˜í•´ì•¼ í•©ë‹ˆë‹¤.</p>

<p>LSB ìŠ¤í™ì„ ì¤€ìˆ˜í•˜ì—¬ ì§ì ‘ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h4 id="ocf-resource-agents">OCF Resource Agents</h4>

<p>ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” LSB ìµìŠ¤í…ì…˜ì…ë‹ˆë‹¤.
ì•„ë˜ ê²½ë¡œì—ì„œ ê¸°ë³¸ ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
<code>/lib/ocf/resource.d/heartbeat</code></p>

<p>ì €ëŠ” Apacheë¥¼ ì›¹ì„œë²„ë¡œ ì‚¬ìš© í•  ì˜ˆì •ì…ë‹ˆë‹¤.
ë”°ë¼ì„œ ì•„ë˜ ì„¤ì •ì—ëŠ” drbd, apacheê°€ ê°ì ocf,lsbë¥¼ ì´ìš©í•˜ì—¬ êµ¬ë™ë˜ë„ë¡ ì„¤ì •ë˜ì–´ìˆìŠµë‹ˆë‹¤.</p>

<p>CIB(Cluster Information Base) ë¼ê³  ë¶ˆë¦¬ëŠ” Raw xmlì— ìš°ì„  ì„¤ì •ì„ ì €ì¥ í›„ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•©ë‹ˆë‹¤.</p>

<blockquote>
<p>you want to edit the saved CIB using pcs (pcs -f )</p>

<pre><code class="language-bash">root # pcs cluster cib drbd_cfg
root # pcs -f drbd_cfg resource create Data ocf:linbit:drbd drbd_resource=Storage  op monitor timeout=&quot;30&quot; interval=&quot;20&quot; role=&quot;Slave&quot; op monitor timeout=&quot;30&quot; interval=&quot;10&quot; role=&quot;Master&quot;
root # pcs -f drbd_cfg resource master DataSync Data master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true
root # pcs -f drbd_cfg resource create Storage Filesystem device=&quot;/dev/drbd0&quot; directory=&quot;/data&quot; fstype=&quot;xfs&quot;
root # pcs -f drbd_cfg resource create internal_ip ocfğŸ’“IPaddr2 ip=10.0.0.5 cidr_netmask=32 op monitor timeout=&quot;30&quot; interval=&quot;20&quot; role=&quot;Slave&quot; op monitor timeout=&quot;30&quot; interval=&quot;10&quot; role=&quot;Master&quot;
root # pcs -f drbd_cfg resource create external_ip ocfğŸ’“IPaddr2 ip=1.1.1.5 cidr_netmask=32 op monitor timeout=&quot;30&quot; interval=&quot;20&quot; role=&quot;Slave&quot; op monitor timeout=&quot;30&quot; interval=&quot;10&quot; role=&quot;Master&quot;
root # pcs -f drbd_cfg resource create apache lsb:apache op monitor interval=30s
 
root # pcs -f drbd_cfg resource group add HA-GROUP internal_ip external_ip Storage apache
root # pcs -f drbd_cfg constraint colocation add HA-GROUP DataSync INFINITY with-rsc-role=Master
root # pcs -f drbd_cfg constraint order promote DataSync then start Storage
 
root # pcs cluster cib-push drbd_cfg
CIB updated
 
root # pcs resource create ping_check ocf:pacemaker:ping host_list=&quot;10.0.0.1&quot; multiplier=&quot;1000&quot; dampen=10s op monitor interval=5s
root # pcs resource clone ping_check globally-unique=false
</code></pre>

<p>2ê°œì˜ ì•„ì´í”¼ë¥¼ ì„¤ì •í•˜ì˜€ê¸° ë•Œë¬¸ì— ping_checkë¥¼ í•˜ëŠ” ë¦¬ì†ŒìŠ¤ë¥¼ ì¶”ê°€ë¡œ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.(ì£¼ê¸°ì ìœ¼ë¡œ ê²Œì´íŠ¸ì›¨ì´ì— í•‘ì„ ë‚ ë¦¬ê²Œ ë©ë‹ˆë‹¤.)</p>
</blockquote>

<h3 id="í´ëŸ¬ìŠ¤í„°-êµ¬ì„±-í™•ì¸">í´ëŸ¬ìŠ¤í„° êµ¬ì„± í™•ì¸</h3>

<p>pcs status ëª…ë ¹ì–´ë¥¼ í†µí•´ í˜„ì¬ ë…¸ë“œì˜ ìƒíƒœ, ë¦¬ì†ŒìŠ¤ ë¦¬ìŠ¤íŠ¸, ë°ëª¬ìƒíƒœë¥¼ ëª¨ë‘ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<pre><code class="language-bash">root # pcs status
Cluster name: FileCluster
Stack: corosync
Current DC: master (version 1.1.15-11.el7_3.2-e174ec8) - partition with quorum
Last updated: Sat Mar  4 00:05:29 2017		Last change: Fri Mar  3 22:20:13 2017 by root via cibadmin on master
 
2 nodes and 8 resources configured
 
Online: [ master standby ]
 
Full list of resources:
 
 Master/Slave Set: DataSync [Data]
     Masters: [ master ]
     Slaves: [ standby ]
 Resource Group: HA-GROUP
     internal_ip	(ocf:ğŸ’“IPaddr2):	Started master
     external_ip	(ocf:ğŸ’“IPaddr2):	Started master
     Storage	(ocf:ğŸ’“Filesystem):	Started master
     apache	(lsb:apache):	Started master
 Clone Set: ping_check-clone [ping_check]
     Started: [ master standby ]
 
Daemon Status:
  corosync: active/disabled
  pacemaker: active/disabled
  pcsd: active/enabled
</code></pre>

<h2 id="ê·¸-ì™¸-ì†Œì†Œí•œ-íŒ">ê·¸ ì™¸ ì†Œì†Œí•œ íŒ</h2>

<h3 id="pcs-ì„¤ì •-ì‚­ì œ">PCS ì„¤ì • ì‚­ì œ</h3>

<p>ì„¤ì •ì„ ì˜ëª»í• ë•Œê°€ ìˆì£ .. ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ ë‹¤ì‹œ ì‹œì‘í•  ë•Œ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<pre><code class="language-bash">root # pcs cluster stop --all
root # pcs cluster destroy --all
</code></pre>

<h3 id="pcs-cluster-standby-ì„¤ì •-on-off">PCS cluster standby ì„¤ì • (on/off)</h3>

<p>ì¥ì• í…ŒìŠ¤ëŠëŠ” ì•„ë˜ì™€ ê°™ì´ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.
standby ë¡œ ì„¤ì •í•˜ë©´ í•´ë‹¹ ë…¸ë“œì˜ ìƒíƒœê°€ Onlineì—ì„œ standbyë¡œ ë˜ë©° ì„œë¹„ìŠ¤ì—ì„œ ë¹ ì§‘ë‹ˆë‹¤.</p>

<pre><code class="language-bash">root # pcs cluster standby $CLUSTER_NAME
root # pcs cluster unstandby $CLUSTER_NAME
</code></pre>

<h3 id="linux-ha-manual-pages">Linux-HA manual pages</h3>

<p>ì˜ì–´ë¥¼ ì˜í•˜ì‹ ë‹¤ë©´ ì½ê³  ì „ì²´ ë²ˆì—­ì„ ë¶€íƒë“œë ¤ë„ ë ê¹Œìš”</p>

<h3 id="pcs-apache-settting">PCS APACHE SETTTING</h3>

<p>ì „ lsbë¡œ ì˜¬ë ¸ì§€ë§Œ(init.d/apacheë¥¼ ì§ì ‘ë§Œë“¤ì—ˆì–´ìš”) ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ëŠ” OCFë¥¼ ì‚¬ìš©í•˜ì‹œëŠ” ê²ƒ ë˜í•œ ë°©ë²•ì…ë‹ˆë‹¤.</p>

<p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-apache-active-passive-cluster-using-pacemaker-on-centos-7">LINK1</a><br />
<a href="http://linux-ha.org/doc/man-pages/re-ra-apache.html">LINK2</a></p>

<pre><code class="language-bash">pcs resource create apache ocfğŸ’“apache \
configfile=/etc/httpd/conf/httpd.conf \
statusurl=&quot;http://localhost/server-status&quot; \
op monitor timeout=&quot;20s&quot; interval=&quot;10&quot;
</code></pre>

<h3 id="logging">Logging</h3>

<p>ì•„ë˜ ë¡œê·¸ë¥¼ ë³´ëŠ”ê±´ ê¸°ë³¸ì´ì£ ? :-)</p>

<ul>
<li>/var/log/cluster/corosync.log</li>
<li>/var/log/pcsd/pcsd.log</li>
<li>/var/log/pacemaker.log</li>
</ul>

<h3 id="crm-mon">crm_mon</h3>

<p>Pacemaker í´ëŸ¬ìŠ¤í„° ë¦¬ì†ŒìŠ¤ ë§¤ë‹ˆì €ì˜ í•œ ë¶€ë¶„..</p>

<p><code>pcs status</code>ë¥¼ ì—¬ëŸ¬ë²ˆ ì…ë ¥í•˜ê¸´ í˜ë“¤ê¸° ë•Œë¬¸ì— ì „ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<p>ê·¸ëŸ¼ ì´ë§Œ :-)</p>

                <br>
                
                  <div class="tags">
                    <strong>Tags:</strong>
                  
                    <a href="https://yoanp.github.io/tags/ha">HA</a>
                  
                    <a href="https://yoanp.github.io/tags/pcs">pcs</a>
                  
                  </div>
                  <br />
                
                <p class="back-to-posts"><a href="https://yoanp.github.io/blog">Back to posts</a></p>
            </div>
            <br>
            <div class="disqus">
                
            </div>
            
            <script src="https://utteranc.es/client.js"
                repo=yoanp/blog_comment
                issue-term="pathname"
                theme="github-light"
                crossorigin="anonymous"
                async>
            </script>
            
        </div>
    </div>
</section>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-54005049-4', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.11.0/highlight.min.js"></script>
  

  <script type="text/javascript">
    hljs.initHighlightingOnLoad();
  </script>





</body>
</html>

