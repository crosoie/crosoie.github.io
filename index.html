<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Grit">
<meta property="og:type" content="website">
<meta property="og:title" content="Yoanp">
<meta property="og:url" content="http://yoanp.github.io/index.html">
<meta property="og:site_name" content="Yoanp">
<meta property="og:description" content="Grit">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Yoanp">
<meta name="twitter:description" content="Grit">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoanp.github.io/"/>





  <title> Yoanp </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Yoanp</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">My Blog</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2017/03/04/pcs를-이용한-ha구성/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/04/pcs를-이용한-ha구성/" itemprop="url">
                  PCS를 이용한 HA구성
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-03-04T00:15:23+09:00">
                2017-03-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><code>pcs</code>: pacemaker/corosync 설정,관리 시스템</p>
<blockquote>
<p><code>pacemaker</code>: 고가용성 클러스터 리소스 관리자 (고장을 인지한 경우 대기장비로 서비스를 넘깁니다.- failover)<br><code>corosync</code>: 그룹커뮤니케이션 시스템을 구현하기 위한 HA기능 API 제공 (node status)</p>
</blockquote>
<p>pcs를 이용하여 두대의 서버를 하나의 클러스터로 묶어 HA를 구현합니다.<br>마스터 서버 장애시 스탠바이 장비가 마스터로 승계됩니다.<br>두대 서버 모두 동일한 데이터를 유지하고 있어야 하기 때문에 이 문서에서는 단순 동기화 방식이 아닌 <code>drbd</code>를 구성 할 예정입니다.</p>
<blockquote>
<p><code>drbd</code>: HA 클러스터를 위해 디자인 된 네트워크 블럭 디바이스</p>
</blockquote>
<hr>
<h1 id="기본-정보"><a href="#기본-정보" class="headerlink" title="기본 정보"></a>기본 정보</h1><blockquote>
<p>CentOS 7.3<br>pcs-0.9.152-10<br>pacemaker-1.1<br>corosync-2.4</p>
</blockquote>
<hr>
<h1 id="기본-설정"><a href="#기본-설정" class="headerlink" title="기본 설정"></a>기본 설정</h1><h2 id="호스트-설정"><a href="#호스트-설정" class="headerlink" title="호스트 설정"></a>호스트 설정</h2><blockquote>
<p>두서버 모두 적용 해 주세요.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># cat /etc/hosts</span></div><div class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</div><div class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</div><div class="line"> </div><div class="line">10.0.0.3 master</div><div class="line">10.0.0.4 standby</div></pre></td></tr></table></figure>
<h2 id="방화벽-설정"><a href="#방화벽-설정" class="headerlink" title="방화벽 설정"></a>방화벽 설정</h2><p>두서버가 서로 통신이 되어야 합니다.<br>저는 내부망을 ALL로 열었어요…</p>
<hr>
<h1 id="DRBD"><a href="#DRBD" class="headerlink" title="DRBD"></a>DRBD</h1><h2 id="패키지-설치"><a href="#패키지-설치" class="headerlink" title="패키지 설치"></a>패키지 설치</h2><p>DRBD 패키지를 설치해줍니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># cd /usr/local/src</span></div><div class="line">root <span class="comment"># wget http://elrepo.reloumirrors.net/elrepo/el7/x86_64/RPMS/elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></div><div class="line">root <span class="comment"># rpm -ivh elrepo-release-7.0-2.el7.elrepo.noarch.rpm</span></div><div class="line">root <span class="comment"># yum -y install drbd kmod-drbd84 kernel-devel</span></div></pre></td></tr></table></figure>
<h2 id="DRBD-설정"><a href="#DRBD-설정" class="headerlink" title="DRBD 설정"></a>DRBD 설정</h2><blockquote>
<p>global 설정 파일에서 18~20줄 주석을 해제합니다.</p>
</blockquote>
<h3 id="리소스-파일을-생성합니다"><a href="#리소스-파일을-생성합니다" class="headerlink" title="리소스 파일을 생성합니다"></a>리소스 파일을 생성합니다</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># vi /etc/drbd.d/storage.res</span></div><div class="line">resource <span class="string">"storage"</span> &#123;</div><div class="line">     protocol C;</div><div class="line">     startup &#123;</div><div class="line">          wfc-timeout       0;      <span class="comment">## Infinite!</span></div><div class="line">          degr-wfc-timeout  120;    <span class="comment">## 2 minutes.</span></div><div class="line">     &#125;</div><div class="line">     disk &#123;</div><div class="line">        on-io-error detach;</div><div class="line">        resync-rate 300M;</div><div class="line">     &#125;</div><div class="line">    net &#123;</div><div class="line">        timeout             60;     <span class="comment">#  6 seconds  (unit = 0.1 seconds)</span></div><div class="line">        connect-int         10;     <span class="comment"># 10 seconds  (unit = 1 second)</span></div><div class="line">        ping-int            10;     <span class="comment"># 10 seconds  (unit = 1 second)</span></div><div class="line">        max-buffers         20000;</div><div class="line">        unplug-watermark    20000;</div><div class="line">        max-epoch-size      20000;</div><div class="line">    &#125;</div><div class="line">     <span class="comment"># It is valid to move device, disk and meta-disk to the</span></div><div class="line">     <span class="comment"># resource level.</span></div><div class="line">    on master &#123;</div><div class="line">        device /dev/drbd0;</div><div class="line">        disk /dev/sda5;</div><div class="line">        address 10.0.0.3:7789;</div><div class="line">        meta-disk internal;</div><div class="line">    &#125;</div><div class="line">    on standby &#123;</div><div class="line">        device /dev/drbd0;</div><div class="line">        disk /dev/sda5;</div><div class="line">        address 10.0.0.3:7789;</div><div class="line">        meta-disk internal;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="DRBD-리소스-생성"><a href="#DRBD-리소스-생성" class="headerlink" title="DRBD 리소스 생성"></a>DRBD 리소스 생성</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># drbdadm create-md storage</span></div><div class="line">initializing activity <span class="built_in">log</span></div><div class="line">NOT initializing bitmap</div><div class="line">Writing meta data...</div><div class="line">New drbd meta data block successfully created.</div></pre></td></tr></table></figure>
<h2 id="DRBD-구동-및-동기화"><a href="#DRBD-구동-및-동기화" class="headerlink" title="DRBD 구동 및 동기화"></a>DRBD 구동 및 동기화</h2><p>실행!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># systemctl start drbd</span></div></pre></td></tr></table></figure>
<h2 id="데이터-동기화를-합니다"><a href="#데이터-동기화를-합니다" class="headerlink" title="데이터 동기화를 합니다"></a>데이터 동기화를 합니다</h2><blockquote>
<p>MASTER에서 실행합니다.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># drbdadm -- --overwrite-data-of-peer primary storage</span></div></pre></td></tr></table></figure>
<hr>
<h1 id="HA-구성"><a href="#HA-구성" class="headerlink" title="HA 구성"></a>HA 구성</h1><h2 id="패키지-설치-1"><a href="#패키지-설치-1" class="headerlink" title="패키지 설치"></a>패키지 설치</h2><blockquote>
<p>두서버 모두 적용 해 주세요.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y corosync pacemaker pcs resource-agents</div></pre></td></tr></table></figure>
<h2 id="pcsd-실행"><a href="#pcsd-실행" class="headerlink" title="pcsd 실행"></a>pcsd 실행</h2><blockquote>
<p>두서버 모두 적용 해 주세요.</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">systemctl start pcsd.service</div><div class="line">systemctl <span class="built_in">enable</span> pcsd.service</div><div class="line">systemctl <span class="built_in">enable</span> corosync.service</div><div class="line">systemctl <span class="built_in">enable</span> pacemaker.service</div></pre></td></tr></table></figure>
<h2 id="인증-계정-적용"><a href="#인증-계정-적용" class="headerlink" title="인증 계정 적용"></a>인증 계정 적용</h2><p>해당 인증 계정 설정을 통하여 한대의 서버에서 클러스터를 생성할 경우 모든 서버에 반영이 됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># passwd hacluster</span></div><div class="line">hacluster 사용자의 비밀 번호 변경 중</div><div class="line">새  암호 :</div><div class="line">root <span class="comment"># pcs cluster auth master</span></div><div class="line">Username: hacluster</div><div class="line">Password: ********************</div><div class="line">root <span class="comment"># pcs cluster auth standby</span></div><div class="line">Username: hacluster</div><div class="line">Password: ********************</div></pre></td></tr></table></figure>
<p>정상적으로 인증되었는지 확인합니다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs cluster auth master standby</span></div><div class="line">master: Already authorized</div><div class="line">standby: Already authorized</div></pre></td></tr></table></figure>
<h2 id="클러스터-구성"><a href="#클러스터-구성" class="headerlink" title="클러스터 구성"></a>클러스터 구성</h2><p><code>FileCluster</code>란 이름의 클러스터를 생성합니다.<br>해당 클러스터엔 master/standby 두대의 서버가 포함됩니다.<br>데이터 전송은 UDP통신을 사용하도록 설정하였습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs cluster setup --start --name FileCluster master standby --transport udpu</span></div></pre></td></tr></table></figure>
<p>프로퍼티 설정을 추가로 진행합니다.</p>
<p><code>STONITH</code>: (Shoot The Head in The Head) 가짜 노드 혹은 의도치 않은 동시 엑세스로 인한 데이터 손상을 보호합니다.<br><code>no-quorum-policy</code>: 클러스터에 quorum이 없을 때의 수행작업을 설정합니다.<br><code>resource-stickiness</code>: 서비스 지속력</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs property set stonith-enabled=false</span></div><div class="line">root <span class="comment"># pcs property set no-quorum-policy=ignore</span></div><div class="line">root <span class="comment"># pcs property set default-resource-stickiness=100</span></div></pre></td></tr></table></figure>
<p>정상적으로 구성되었는지 확인합니다</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs status</span></div><div class="line">Cluster name: FileCluster</div><div class="line">Stack: corosync</div><div class="line">Current DC: master (version 1.1.15-11.el7_3.2<span class="_">-e</span>174ec8) - partition with quorum</div><div class="line">Last updated: Fri Mar  3 14:47:29 2017		Last change: Fri Mar  3 23:27:16 2017 by hacluster via crmd on master</div><div class="line"> </div><div class="line">2 nodes and 0 resources configured</div><div class="line"> </div><div class="line">Online: [ master standby ]</div><div class="line"> </div><div class="line">No resources</div><div class="line"> </div><div class="line"> </div><div class="line">Daemon Status:</div><div class="line">  corosync: active/disabled</div><div class="line">  pacemaker: active/disabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure>
<h2 id="리소스-생성"><a href="#리소스-생성" class="headerlink" title="리소스 생성"></a>리소스 생성</h2><p>failover 설정이 포함되도록 리소스를 생성합니다.</p>
<p>우선 리소스 에이전트의 종류는 아래와 같습니다.</p>
<h3 id="Heartbeat-Resource-Agents"><a href="#Heartbeat-Resource-Agents" class="headerlink" title="Heartbeat Resource Agents"></a>Heartbeat Resource Agents</h3><p>예전에 사용하던 LSB방식의 init 스크립트를 뜻합니다.</p>
<h3 id="LSB-Resource-Agents"><a href="#LSB-Resource-Agents" class="headerlink" title="LSB Resource Agents"></a>LSB Resource Agents</h3><p><code>/etc/init.d</code> 아래에 존재하는 스크립트입니다. 기본적으로 OS/배포판에서 제공합니다.<br>하지만 <a href="http://refspecs.linux-foundation.org/LSB_3.2.0/LSB-Core-generic/LSB-Core-generic/iniscrptact.html" target="_blank" rel="external">LSB 스펙</a>을 준수해야 합니다.</p>
<p>LSB 스펙을 준수하여 직접 스크립트를 만들어 사용할 수 있습니다.</p>
<h3 id="OCF-Resource-Agents"><a href="#OCF-Resource-Agents" class="headerlink" title="OCF Resource Agents"></a>OCF Resource Agents</h3><p>기본적으로 제공하는 LSB 익스텐션입니다.<br>아래 경로에서 기본 스크립트를 확인 할 수 있습니다.<br><code>/lib/ocf/resource.d/heartbeat</code></p>
<p>저는 Apache를 웹서버로 사용 할 예정입니다.<br>따라서 아래 설정에는 drbd, apache가 각자 ocf,lsb를 이용하여 구동되도록 설정되어있습니다.</p>
<p>CIB(Cluster Information Base) 라고 불리는 Raw xml에 우선 설정을 저장 후 업데이트하는 방식으로 진행합니다.</p>
<blockquote>
<p>you want to edit the saved CIB using pcs (pcs -f <command>)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs cluster cib drbd_cfg</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource create Data ocf:linbit:drbd drbd_resource=Storage  op monitor timeout="30" interval="20" role="Slave" op monitor timeout="30" interval="10" role="Master"</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource master DataSync Data master-max=1 master-node-max=1 clone-max=2 clone-node-max=1 notify=true</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource create Storage Filesystem device="/dev/drbd0" directory="/data" fstype="xfs"</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource create internal_ip ocf:heartbeat:IPaddr2 ip=10.0.0.5 cidr_netmask=32 op monitor timeout="30" interval="20" role="Slave" op monitor timeout="30" interval="10" role="Master"</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource create external_ip ocf:heartbeat:IPaddr2 ip=1.1.1.5 cidr_netmask=32 op monitor timeout="30" interval="20" role="Slave" op monitor timeout="30" interval="10" role="Master"</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource create apache lsb:apache op monitor interval=30s</span></div><div class="line"> </div><div class="line">root <span class="comment"># pcs -f drbd_cfg resource group add HA-GROUP internal_ip external_ip Storage apache</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg constraint colocation add HA-GROUP DataSync INFINITY with-rsc-role=Master</span></div><div class="line">root <span class="comment"># pcs -f drbd_cfg constraint order promote DataSync then start Storage</span></div><div class="line"> </div><div class="line">root <span class="comment"># pcs cluster cib-push drbd_cfg</span></div><div class="line">CIB updated</div><div class="line"> </div><div class="line">root <span class="comment"># pcs resource create ping_check ocf:pacemaker:ping host_list="10.0.0.1" multiplier="1000" dampen=10s op monitor interval=5s</span></div><div class="line">root <span class="comment"># pcs resource clone ping_check globally-unique=false</span></div></pre></td></tr></table></figure>
<blockquote>
<p>2개의 아이피를 설정하였기 때문에 ping_check를 하는 리소스를 추가로 설정하였습니다.(주기적으로 게이트웨이에 핑을 날리게 됩니다.)</p>
</blockquote>
<h2 id="클러스터-구성-확인"><a href="#클러스터-구성-확인" class="headerlink" title="클러스터 구성 확인"></a>클러스터 구성 확인</h2><p><code>pcs status</code> 명령어를 통해 현재 노드의 상태, 리소스 리스트, 데몬상태를 모두 확인 할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs status</span></div><div class="line">Cluster name: FileCluster</div><div class="line">Stack: corosync</div><div class="line">Current DC: master (version 1.1.15-11.el7_3.2<span class="_">-e</span>174ec8) - partition with quorum</div><div class="line">Last updated: Sat Mar  4 00:05:29 2017		Last change: Fri Mar  3 22:20:13 2017 by root via cibadmin on master</div><div class="line"> </div><div class="line">2 nodes and 8 resources configured</div><div class="line"> </div><div class="line">Online: [ master standby ]</div><div class="line"> </div><div class="line">Full list of resources:</div><div class="line"> </div><div class="line"> Master/Slave Set: DataSync [Data]</div><div class="line">     Masters: [ master ]</div><div class="line">     Slaves: [ standby ]</div><div class="line"> Resource Group: HA-GROUP</div><div class="line">     internal_ip	(ocf::heartbeat:IPaddr2):	Started master</div><div class="line">     external_ip	(ocf::heartbeat:IPaddr2):	Started master</div><div class="line">     Storage	(ocf::heartbeat:Filesystem):	Started master</div><div class="line">     apache	(lsb:apache):	Started master</div><div class="line"> Clone Set: ping_check-clone [ping_check]</div><div class="line">     Started: [ master standby ]</div><div class="line"> </div><div class="line">Daemon Status:</div><div class="line">  corosync: active/disabled</div><div class="line">  pacemaker: active/disabled</div><div class="line">  pcsd: active/enabled</div></pre></td></tr></table></figure>
<hr>
<h1 id="그-외-소소한-팁"><a href="#그-외-소소한-팁" class="headerlink" title="그 외 소소한 팁"></a>그 외 소소한 팁</h1><h2 id="PCS-설정-삭제"><a href="#PCS-설정-삭제" class="headerlink" title="PCS 설정 삭제"></a>PCS 설정 삭제</h2><p>설정을 잘못할때가 있죠.. 새로운 마음으로 다시 시작할 때 아래와 같이 사용합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs cluster stop --all</span></div><div class="line">root <span class="comment"># pcs cluster destroy --all</span></div></pre></td></tr></table></figure>
<h2 id="PCS-cluster-standby-설정-on-off"><a href="#PCS-cluster-standby-설정-on-off" class="headerlink" title="PCS cluster standby 설정 (on/off)"></a>PCS cluster standby 설정 (on/off)</h2><p>장애테스느는 아래와 같이 하시면 됩니다.<br>standby 로 설정하면 해당 노드의 상태가 Online에서 standby로 되며 서비스에서 빠집니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pcs cluster standby $CLUSTER_NAME</span></div><div class="line">root <span class="comment"># pcs cluster unstandby $CLUSTER_NAME</span></div></pre></td></tr></table></figure>
<h2 id="Linux-HA-manual-pages"><a href="#Linux-HA-manual-pages" class="headerlink" title="Linux-HA manual pages"></a>Linux-HA manual pages</h2><p><a href="http://linux-ha.org/doc/man-pages/man-pages.html" target="_blank" rel="external">영어를 잘하신다면 읽고 전체 번역을 부탁드려도 될까요</a></p>
<h2 id="PCS-APACHE-SETTTING"><a href="#PCS-APACHE-SETTTING" class="headerlink" title="PCS APACHE SETTTING"></a>PCS APACHE SETTTING</h2><p>전 lsb로 올렸지만(init.d/apache를 직접만들었어요) 기본적으로 제공하는 OCF를 사용하시는 것 또한 방법입니다.</p>
<p><a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-an-apache-active-passive-cluster-using-pacemaker-on-centos-7" target="_blank" rel="external">LINK1</a><br><a href="http://linux-ha.org/doc/man-pages/re-ra-apache.html" target="_blank" rel="external">LINK2</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">pcs resource create apache ocf:heartbeat:apache \</div><div class="line">configfile=/etc/httpd/conf/httpd.conf \</div><div class="line">statusurl=<span class="string">"http://localhost/server-status"</span> \</div><div class="line">op monitor timeout=<span class="string">"20s"</span> interval=<span class="string">"10"</span></div></pre></td></tr></table></figure>
<h2 id="Logging"><a href="#Logging" class="headerlink" title="Logging"></a>Logging</h2><p>아래 로그를 보는건 기본이죠? :-)</p>
<p><code>/var/log/cluster/corosync.log</code><br><code>/var/log/pcsd/pcsd.log</code><br><code>/var/log/pacemaker.log</code></p>
<h2 id="crm-mon"><a href="#crm-mon" class="headerlink" title="crm_mon"></a>crm_mon</h2><p>Pacemaker 클러스터 리소스 매니저의 한 부분..</p>
<p><code>pcs status</code>를 여러번 입력하긴 힘들기 때문에 전 사용합니다.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2017/02/23/dicrect-lvs mode for docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/23/dicrect-lvs mode for docker/" itemprop="url">
                  direct-lvm mode for docker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-02-23T20:52:00+09:00">
                2017-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Docker는 ubuntu에서 개발되었습니다.<br>그렇기 떄문에 도커의 기본적인 파일 스토리지 시스템은 <a href="https://en.wikipedia.org/wiki/Aufs" target="_blank" rel="external">AUFS</a>입니다.<br>문제는 AUFS는 레드헷 개열에서 지원하지 않는 파일시스템이지요.</p>
<p>도커가 유명해지면서 REHL에서 사용하길 원하는 니즈가 급증하자 Redhat과 docker에서 협력하여 파일 스토리지 시스템 드라이버를 개발하였습니다.<br>해당 드라이버의 이름이 Devicemapper입니다.<br>도커의 두번째 공식 파일 스토리지 드라이버가 되었지요.<br>그래서 레드햇 계열 리눅스에 도커를 설치하면 Devicemapper가 드라이버로 loop-lvm 모드로 올라옵니다.<br>문제는 상용으로 사용시 loop-lvm으로 사용하면 안된다는 점입니다.</p>
<blockquote>
<p><code>loop-lvm</code>: sparse 파일을 이용하여 이미지와 컨테이너 스냅샷이 사용하는 가상 풀을 생성합니다.<br>sparse 파일은 저장장치가 꽉 차거나 디스크 크기 할당량 초과 시 쓰기 문제가 발생 할 수 있습니다. 또한 모든 복사와 백업에 대한 완벽한 지원을 보장하지 않습니다.<br>속도가 느립니다..</p>
<p><code>direct-lvm</code>: 드라이버가 할당된 lvm 블록 장치에 직접 read/write를 수행합니다.</p>
</blockquote>
<p>아래는 도커사에서 제공하는 드라이버 비교 표 입니다.<br><img src="https://docs.docker.com/engine/userguide/storagedriver/images/driver-pros-cons.png" alt="드라이버 비교"></p>
<p>그럼 이제 direct-lvm 모드로 설정해보겠습니다.</p>
<h3 id="Configure-direct-lvm-mode-for-production"><a href="#Configure-direct-lvm-mode-for-production" class="headerlink" title="Configure direct-lvm mode for production"></a><a href="https://docs.docker.com/engine/userguide/storagedriver/device-mapper-driver/#/configure-direct-lvm-mode-for-production" target="_blank" rel="external">Configure direct-lvm mode for production</a></h3><blockquote>
<p>이미 사용하고 있는 이미지가 있다면 백업해주세요. (개인 Registry 혹은 도커 허브 등..)</p>
</blockquote>
<h4 id="도커-데몬-중단"><a href="#도커-데몬-중단" class="headerlink" title="도커 데몬 중단"></a>도커 데몬 중단</h4><h4 id="물리-디스크-LVM-설정"><a href="#물리-디스크-LVM-설정" class="headerlink" title="물리 디스크 LVM 설정"></a>물리 디스크 LVM 설정</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># fdisk /dev/xvdb</span></div><div class="line">...</div><div class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): t</div><div class="line">Selected partition 1</div><div class="line">Hex code (<span class="built_in">type</span> L to list all codes): 8e</div><div class="line">Changed <span class="built_in">type</span> of partition <span class="string">'Linux'</span> to <span class="string">'Linux LVM'</span></div></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># fdisk -l /dev/xvdb</span></div><div class="line">Disk /dev/xvdb: 107.4 GB, 107374182400 bytes, 209715200 sectors</div><div class="line">Units = sectors of 1 * 512 = 512 bytes</div><div class="line">Sector size (logical/physical): 512 bytes / 512 bytes</div><div class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</div><div class="line">Disk label <span class="built_in">type</span>: dos</div><div class="line">Disk identifier: 0xa38a231b</div><div class="line">    Device Boot      Start         End      Blocks   Id  System</div><div class="line">/dev/xvdb1            2048   209715199   104856576   8e  Linux LVM</div></pre></td></tr></table></figure>
<h4 id="LVM2-thin-provisioning-tools-설치"><a href="#LVM2-thin-provisioning-tools-설치" class="headerlink" title="LVM2, thin-provisioning-tools 설치"></a>LVM2, thin-provisioning-tools 설치</h4><p>thin-provisioning-tools는 lvm2를 설치할때 설치 되는 device-mapper-persistent-data에 포함되어있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># yum install lvm2 -y</span></div><div class="line">...</div><div class="line">Installed:</div><div class="line">  lvm2.x86_64 7:2.02.166-1.el7_3.2</div><div class="line">Dependency Installed:</div><div class="line">  device-mapper-event.x86_64 7:1.02.135-1.el7_3.2                           device-mapper-event-libs.x86_64 7:1.02.135-1.el7_3.2</div><div class="line">  device-mapper-persistent-data.x86_64 0:0.6.3-1.el7                        libaio.x86_64 0:0.3.109-13.el7</div><div class="line">  lvm2-libs.x86_64 7:2.02.166-1.el7_3.2</div><div class="line">Dependency Updated:</div><div class="line">  device-mapper.x86_64 7:1.02.135-1.el7_3.2                                device-mapper-libs.x86_64 7:1.02.135-1.el7_3.2</div></pre></td></tr></table></figure>
<h4 id="dev-xvdb1을-대체하는-물리적-볼륨-생성"><a href="#dev-xvdb1을-대체하는-물리적-볼륨-생성" class="headerlink" title="/dev/xvdb1을 대체하는 물리적 볼륨 생성"></a>/dev/xvdb1을 대체하는 물리적 볼륨 생성</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># pvcreate /dev/xvdb1</span></div><div class="line">  Physical volume <span class="string">"/dev/xvdb1"</span> successfully created.</div></pre></td></tr></table></figure>
<h4 id="도커-불륨-그룹-생성"><a href="#도커-불륨-그룹-생성" class="headerlink" title="도커 불륨 그룹 생성"></a>도커 불륨 그룹 생성</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># vgcreate docker /dev/xvdb1</span></div><div class="line">  Volume group <span class="string">"docker"</span> successfully created</div></pre></td></tr></table></figure>
<h4 id="thinpool과-thinpoolmeta라는-이름의-논리-볼륨-생성"><a href="#thinpool과-thinpoolmeta라는-이름의-논리-볼륨-생성" class="headerlink" title="thinpool과 thinpoolmeta라는 이름의 논리 볼륨 생성"></a>thinpool과 thinpoolmeta라는 이름의 논리 볼륨 생성</h4><p>저장공간이 부족 할 때를 대비하여 95%의 논리 데이터를 할당하였습니다.<br>이후 공간이 부족 할 때 임시 방편으로 데이터나 메타데이터를 자동으로 확장하기 위함입니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># lvcreate --wipesignatures y -n thinpool docker -l 95%VG</span></div><div class="line">  Logical volume <span class="string">"thinpool"</span> created.</div><div class="line">root <span class="comment"># lvcreate --wipesignatures y -n thinpoolmeta docker -l 1%VG</span></div><div class="line">  Logical volume <span class="string">"thinpoolmeta"</span> created.</div></pre></td></tr></table></figure>
<h4 id="해당-풀을-thin-pool로-컨버팅"><a href="#해당-풀을-thin-pool로-컨버팅" class="headerlink" title="해당 풀을 thin pool로 컨버팅"></a>해당 풀을 thin pool로 컨버팅</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># lvconvert -y --zero n -c 512K --thinpool docker/thinpool --poolmetadata docker/thinpoolmeta</span></div><div class="line">  WARNING: Converting logical volume docker/thinpool and docker/thinpoolmeta to thin pool<span class="string">'s data and metadata volumes with metadata wiping.</span></div><div class="line">  THIS WILL DESTROY CONTENT OF LOGICAL VOLUME (filesystem etc.)</div><div class="line">  Converted docker/thinpool to thin pool.</div></pre></td></tr></table></figure>
<h4 id="LVM-프로필을-이용하여-해당-풀의-자동-확장-기능을-설정합니다"><a href="#LVM-프로필을-이용하여-해당-풀의-자동-확장-기능을-설정합니다" class="headerlink" title="LVM 프로필을 이용하여 해당 풀의 자동 확장 기능을 설정합니다"></a>LVM 프로필을 이용하여 해당 풀의 자동 확장 기능을 설정합니다</h4><blockquote>
<p><code>thin_pool_autoextend_threshold</code>: autoextend가 발생되는 시기를 정의하는 %값입니다.<br><code>thin_pool_autoextend_percent</code>: autoextend가 진행되었을 때 확장 가능한 디스크 %을 설정합니다.</p>
</blockquote>
<p>아래와 같이 파일을 설정합니다.<br>100G 풀에서 80G를 사용하게 될 경우 100G가 풀이 110G로 확장되겠네요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># cat /etc/lvm/profile/docker-thinpool.profile</span></div><div class="line">activation &#123;</div><div class="line">    thin_pool_autoextend_threshold=80</div><div class="line">    thin_pool_autoextend_percent=10</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="새로운-lvm-프로필을-적용시켜줍니다"><a href="#새로운-lvm-프로필을-적용시켜줍니다" class="headerlink" title="새로운 lvm 프로필을 적용시켜줍니다"></a>새로운 lvm 프로필을 적용시켜줍니다</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># lvchange --metadataprofile docker-thinpool docker/thinpool</span></div><div class="line">  Logical volume docker/thinpool changed.</div></pre></td></tr></table></figure>
<h4 id="lv가-모니터링되고-있는지-확인합니다"><a href="#lv가-모니터링되고-있는지-확인합니다" class="headerlink" title="lv가 모니터링되고 있는지 확인합니다"></a>lv가 모니터링되고 있는지 확인합니다</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">root <span class="comment">#  lvs -o+seg_monitor</span></div><div class="line">  LV       VG     Attr       LSize  Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert Monitor</div><div class="line">  thinpool docker twi<span class="_">-a</span>-t--- 95.00g             0.00   0.01                             monitored</div></pre></td></tr></table></figure>
<h4 id="기존에-사용하는-도커가-있다면-백업해줍시다"><a href="#기존에-사용하는-도커가-있다면-백업해줍시다" class="headerlink" title="기존에 사용하는 도커가 있다면 백업해줍시다"></a>기존에 사용하는 도커가 있다면 백업해줍시다</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># mkdir /var/lib/docker.bk</span></div><div class="line">root <span class="comment"># mv /var/lib/docker/* /var/lib/docker.bk</span></div></pre></td></tr></table></figure>
<h4 id="devicemapper-옵션을-설정합니다"><a href="#devicemapper-옵션을-설정합니다" class="headerlink" title="devicemapper 옵션을 설정합니다"></a>devicemapper 옵션을 설정합니다</h4><p>daemon.json 파일을 수정하여 진행합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># cat /etc/docker/daemon.json</span></div><div class="line">&#123;</div><div class="line">  <span class="string">"storage-driver"</span>: <span class="string">"devicemapper"</span>,</div><div class="line">   <span class="string">"storage-opts"</span>: [</div><div class="line">     <span class="string">"dm.thinpooldev=/dev/mapper/docker-thinpool"</span>,</div><div class="line">     <span class="string">"dm.use_deferred_removal=true"</span>,</div><div class="line">     <span class="string">"dm.use_deferred_deletion=true"</span></div><div class="line">   ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>누락되는 마운트 포인트를 방지하기 위해 <code>dm.use_deferred_removal</code>, <code>dm.use_deferred_deletion</code> 두개의 옵션은 항상 설정해 주어야 합니다.</p>
</blockquote>
<h4 id="docker-실행"><a href="#docker-실행" class="headerlink" title="docker 실행"></a>docker 실행</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># systemctl start docker</span></div></pre></td></tr></table></figure>
<h4 id="호스트서버에서-devicemapper-구조-확인"><a href="#호스트서버에서-devicemapper-구조-확인" class="headerlink" title="호스트서버에서 devicemapper 구조 확인"></a>호스트서버에서 devicemapper 구조 확인</h4><p><code>lsblk</code> 명령어를 이용하여 현재의 구조를 확인 할 수 있습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># lsblk /dev/xvdb1</span></div><div class="line">NAME                    MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</div><div class="line">xvdb1                   202:17   0  100G  0 part</div><div class="line">├─docker-thinpool_tmeta 253:0    0 1020M  0 lvm</div><div class="line">│ └─docker-thinpool     253:2    0   95G  0 lvm</div><div class="line">└─docker-thinpool_tdata 253:1    0   95G  0 lvm</div><div class="line">  └─docker-thinpool     253:2    0   95G  0 lvm</div></pre></td></tr></table></figure>
<p>오늘 포스트는 여기까지 입니다.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2017/01/20/docker 1.13 Release/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/20/docker 1.13 Release/" itemprop="url">
                  Docker 1.13 Release
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-01-20T22:19:23+09:00">
                2017-01-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1월 19일날 발표 된 docker 1.13의 특징을 소개하는 글 입니다.<br><a href="https://blog.docker.com/2017/01/whats-new-in-docker-1-13" target="_blank" rel="external">도커 공식 블로그</a>을 참고하였습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># docker --version</span></div><div class="line">Docker version 1.13.0, build 49bf474</div></pre></td></tr></table></figure>
<p>특히. 도커 swarm mode가 1.12에 소개되었는데 해당 기능에 대한 기능개선과 변경사항이 생겼습니다.</p>
<h2 id="compose로-swarm-mode-서비스를-배포-할-수-있습니다"><a href="#compose로-swarm-mode-서비스를-배포-할-수-있습니다" class="headerlink" title="compose로 swarm mode 서비스를 배포 할 수 있습니다"></a>compose로 swarm mode 서비스를 배포 할 수 있습니다</h2><p><code>docker stack deploy</code>란 명령어를 통해 compose 파일을 지원합니다.<br>구축 및 서비스 관리가 편해지겠습니다.</p>
<h2 id="예전버전과의-호환성-유지"><a href="#예전버전과의-호환성-유지" class="headerlink" title="예전버전과의 호환성 유지"></a>예전버전과의 호환성 유지</h2><p>도커 데몬보다 클라이언트가 최신버전일 경우 에러가 발생했습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Error response from daemon: client is newer than server</div></pre></td></tr></table></figure>
<p>이젠 그렇지 않다고 합니다.</p>
<h2 id="커맨드-추가"><a href="#커맨드-추가" class="headerlink" title="커맨드 추가"></a>커맨드 추가</h2><p>앞으로 유용하게 사용할 커맨드가 추가되었습니다.</p>
<ul>
<li><code>docker system df</code> : 도커의 디스크 사용량을 보여줍니다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># docker system df</span></div><div class="line">TYPE                TOTAL               ACTIVE              SIZE                RECLAIMABLE</div><div class="line">Images              15                  1                   2.855 GB            2.822 GB (98%)</div><div class="line">Containers          1                   1                   0 B                 0 B</div><div class="line">Local Volumes       0                   0                   0 B                 0 B</div></pre></td></tr></table></figure>
<ul>
<li><code>docker system prune</code> : 사용하지 않는 데이터들이 모두 삭제 됩니다.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">root <span class="comment"># docker system prune</span></div><div class="line">WARNING! This will remove:</div><div class="line">	- all stopped containers</div><div class="line">	- all volumes not used by at least one container</div><div class="line">	- all networks not used by at least one container</div><div class="line">	- all dangling images</div><div class="line">Are you sure you want to <span class="built_in">continue</span>? [y/N]</div></pre></td></tr></table></figure>
<h2 id="명령어-구조-변경"><a href="#명령어-구조-변경" class="headerlink" title="명령어 구조 변경"></a>명령어 구조 변경</h2><p><code>docker container</code>, <code>docker image</code> 등의 명령어 모음을 추가하면서 구조를 변경했습니다.<br>예를들어 <code>docker ps</code> 는 <code>docker container ls</code> 로 실행 할 수 있습니다.<br>조금 더 직관적으로 변했네요.</p>
<h2 id="모니터링-개선"><a href="#모니터링-개선" class="headerlink" title="모니터링 개선"></a>모니터링 개선</h2><p><code>docker service logs</code> 라는 명령어가 새롭게 생겼습니다.<br>swarm으로 실행 한 클러스터들의 로그를 모아서 보여줍니다.</p>
<h2 id="빌드-개선"><a href="#빌드-개선" class="headerlink" title="빌드 개선"></a>빌드 개선</h2><p><code>dorker build</code> 에 새로운 옵션이 추가되었습니다.<br><code>--squash</code> 해당 옵션을 추가하면 사용하는 모든 레이어를 하나로 합쳐준다고 합니다.<br>또한 <code>--compress</code> 옵션도 추가되었습니다.<br>원격 데몬이 데이터를 가지고 올 경우의 속도를 증가시킨다고 하네요..</p>
<h2 id="AWS-Azure-지원-beta"><a href="#AWS-Azure-지원-beta" class="headerlink" title="AWS, Azure 지원 (beta)"></a>AWS, Azure 지원 (beta)</h2><p>오늘은 여기까지입니다.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2016/12/04/docker-swarm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/docker-swarm/" itemprop="url">
                  docker swarm
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-04T01:53:52+09:00">
                2016-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/docker/" itemprop="url" rel="index">
                    <span itemprop="name">docker</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <img src="/images/docker-swarm-hero2.png" width="300" height="300">
<h1 id="docker-swarm"><a href="#docker-swarm" class="headerlink" title="docker swarm"></a>docker swarm</h1><p>도커 1.9 버전에서 베타 딱지를 붙인 채 세상에 나왔던 Swarm은 2016년 7월에 도커 1.12 릴리즈때 베타 딱지를 떼고 도커 엔진에 포함 된 채로 새롭게 나왔습니다. (물론 기존의 Swarm 또한 지원 합니다.)<br>도커 엔진 자체에 포함 된 만큼 여러가지 변화가 생겼습니다.</p>
<ol>
<li>도커 엔진 자체에 포함</li>
<li>도커 엔진에서 swarm mode를 on/off 가능</li>
<li>오버레이 네트워크와 swarm mode의 연계 (외부 키값 저장소가 필요하지 않아짐)</li>
<li>native remote api, cli supported</li>
</ol>
<p>도커사에서 공식적으로 말하고 있는 swarm의 특징은 아래와 같습니다.</p>
<ul>
<li>클러스터링 관리가 도커 엔진 자체에 통합.</li>
<li>분산 가능한 설계</li>
<li>선언적 서비스 모델링 추구</li>
<li>Scale out</li>
<li>자체적인 클러스터 모니터링 제공</li>
<li>멀티 호스트 네트워킹 제공</li>
<li>서비스 Discovery 제공</li>
<li>Load Balacing 제공 (vip, dns RR)</li>
<li>보안은 기본 탑재 (gossip protocol 사용, AES Algorithm)</li>
</ul>
<p>간단하게 docker swarm에 대해서 알아보았습니다<br>다음엔 docker swarm을 구축하고 서비스를 생성하여 배포하는 방법을 알아보겠습니다.</p>
<p>오늘 포스트는 여기까지 입니다.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2016/12/04/SSL-Convert/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/SSL-Convert/" itemprop="url">
                  SSL Convert
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-04T00:36:14+09:00">
                2016-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <hr>
<h4 id="CRT-파일을-PFX로-변환"><a href="#CRT-파일을-PFX로-변환" class="headerlink" title="CRT 파일을 PFX로 변환"></a>CRT 파일을 PFX로 변환</h4><p>Key 파일, Crt 파일, Chain 파일을 PFX 파일로 합체시켜보겠습니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -export -out server.pfx -inkey server.key -in server.crt -certfile server_CHAIN.crt</div></pre></td></tr></table></figure>
<hr>
<h4 id="PFX에서-KEY-뽑아내기"><a href="#PFX에서-KEY-뽑아내기" class="headerlink" title="PFX에서 KEY 뽑아내기"></a>PFX에서 KEY 뽑아내기</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -in server.pfx -nocerts -passin pass:<span class="string">'PASSWORD'</span> -nodes -out server.key</div><div class="line">sed -ni <span class="_">-e</span> <span class="string">'/^-----BEGIN/,/-----END/p'</span> server.key</div></pre></td></tr></table></figure>
<h4 id="PFX에서-인증서-crt-뽑아내기"><a href="#PFX에서-인증서-crt-뽑아내기" class="headerlink" title="PFX에서 인증서(crt) 뽑아내기"></a>PFX에서 인증서(crt) 뽑아내기</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -in server.pfx -clcerts -nokeys -passin pass:<span class="string">'PASSWORD'</span> -out server.crt</div><div class="line">sed -ni <span class="_">-e</span> <span class="string">'/^-----BEGIN/,/-----END/p'</span> server.crt</div></pre></td></tr></table></figure>
<h4 id="PFX에서-체인인증서-뽑아내기"><a href="#PFX에서-체인인증서-뽑아내기" class="headerlink" title="PFX에서 체인인증서 뽑아내기"></a>PFX에서 체인인증서 뽑아내기</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">openssl pkcs12 -in server.pfx -cacerts -nokeys -passin pass:<span class="string">'PASSWORD'</span> -out server_CHAIN.crt</div><div class="line">sed -ni <span class="_">-e</span> <span class="string">'/^-----BEGIN/,/-----END/p'</span> server_CHAIN.crt</div></pre></td></tr></table></figure>
<hr>
<h4 id="key-파일의-패스워드-제거"><a href="#key-파일의-패스워드-제거" class="headerlink" title="key 파일의 패스워드 제거"></a>key 파일의 패스워드 제거</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">/usr/bin/openssl rsa -in server.key -out nopass.key</div><div class="line">Enter pass phrase <span class="keyword">for</span> server.key: xxxx</div><div class="line">writing RSA key</div><div class="line">mv  server.key server_pass.key</div><div class="line">mv nopass.key server.key</div></pre></td></tr></table></figure>
<p>오늘 포스트는 여기까지 입니다.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2016/12/04/Linux-Perfomance-Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/Linux-Perfomance-Analysis/" itemprop="url">
                  Linux Perfomance Analysis
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-04T00:33:52+09:00">
                2016-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>넷플릭스 테크 블로그에 올라온 <a href="http://techblog.netflix.com/2015/11/linux-performance-analysis-in-60s.html?m=1" target="_blank" rel="external">포스트</a>를 번역하였습니다.<br>시스템 엔지니어로써 기본적으로 알아야하는 명령어들입니다.<br>리마인드 겸 제 입맛에 맞게 해석-작성되었으니.. 참고해주시면 감사하겠습니다.</p>
<p>당신은 서버의 퍼포먼스 이슈가 발생하여 서버에 로그인 하였을 때 1분 동안 확인 하는 것이 무엇입니까?</p>
<p>우리(넷플릭스)는 거대한 EC2 리눅스 클라우드를 가지고 있으며, 다수의 퍼포먼스 분석 툴을 이용한 모니터링 및 퍼포먼스에 대한 연구를 진행하고 있습니다.</p>
<p>그 툴들에는 <a href="http://techblog.netflix.com/2014/12/introducing-atlas-netflixs-primary.html" target="_blank" rel="external">Atlas</a> 와 <a href="http://techblog.netflix.com/2015/04/introducing-vector-netflixs-on-host.html" target="_blank" rel="external">Vector</a> 가 포함되어 있지요. 이러한 도구들은 대부분의 이슈를 해결하는데 도움이 되지만, 때때로 인스턴스에 접근하여 기존의 보편적인 리눅스 퍼포먼스 툴을 사용해야 하는 일들이 생깁니다.</p>
<p>이 포스트를 통해, 넷플릭스 퍼포먼스 엔지니어링 팀이 1분 동안에 당신이 사용할 수 있는 표준 리눅스 툴들을 이용하여 최고의 퍼포먼스 조사하는 방법을 보여드리겠습니다.</p>
<hr>
<h3 id="첫번째-1분-summary"><a href="#첫번째-1분-summary" class="headerlink" title="첫번째 1분: summary"></a>첫번째 1분: summary</h3><p>당신은 1분동안 10개의 커맨드들을 통하여 실행되는 프로세스들과 높은 레벨의 시스템 리소스를 파악해야 합니다.<br>커맨드들은 리소스들을 활용하여 쉽게 해석하여 에러와 포화 메트릭스를 찾습니다.</p>
<ul>
<li>uptime</li>
<li>dmesg | tail</li>
<li>vmstat 1</li>
<li>mpstat -P ALL 1</li>
<li>pidstat 1</li>
<li>iostat -xz 1</li>
<li>free -m</li>
<li>sar -n DEV 1</li>
<li>sar -n TCP,ETCP 1</li>
<li>top</li>
</ul>
<p>몇몇의 커맨드들은 sysstat 패키지의 설치가 필요합니다.<br>이 커맨드들의 매트릭스는 당신이 <a href="http://www.brendangregg.com/usemethod.html" target="_blank" rel="external">USE Method</a>의 일부를 완성하는데 도움을 줄 것입니다.(성능 병목 현상을 찾기 위한 방법)<br>모든 리소스들(CPUs, memory, disks, e.t.c)의 utilization, saturation, and error metrics를 확인하는 것이 포함되어 있습니다.</p>
<p>요약한 커맨드들을 간단하게 설명하겠습니다. 더 많은 정보를 원하시면 맨페이지를 확인하시기 바랍니다.</p>
<h3 id="1-uptime"><a href="#1-uptime" class="headerlink" title="1. uptime"></a>1. uptime</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ uptime</div><div class="line"> 23:51:26 up 21:31,  1 user,  load average: 30.02, 26.43, 19.02</div></pre></td></tr></table></figure>
<p>이 커맨드는 서버의 평균 부하를 빠르게 보는 방법입니다. 리눅스 시스템에서 프로세스들이 실행되기까기 대기하는 시간이지요.<br>이 숫자엔 CPU를 이용해야하는 프로세스들, DISK I/O를 발생시키는 프로세스들이 포함됩니다.<br>이 커맨드는 리소스 부하에 대한 정보를 제공하시만 다른 툴들 없이는 자세한 정보를 확인할 수 없습니다. 단순히 빠르게 파악할 수 있을 뿐이지요.</p>
<p>3개의 숫자는 1분, 5분, 15분간의 평균적인 값입니다.<br>이 숫자들은 지나간 시간동안 어떻게 부하가 변경되었는지 파악할 수 있게 합니다.<br>예를 들어 당신이 문제가 있는 서버를 확인하였을때, 1분의 부하가 15분때의 부하보다 낮다면 당신은 이슈를 놓쳤다고 불 수 있습니다.</p>
<p>부하의 평균 값은 최근 증가량을 보여주는 것입니다. 1분의 값이 30이고, 15분의 값이 19였을 경우 이 숫자들은 많은 의미를 포함하고 있습니다.<br>아마도 CPU를 많이 요구하고 있겠죠, vmstat 또는 mpstat을 확인해보아야 합니다.</p>
<h3 id="2-dmesg-tail"><a href="#2-dmesg-tail" class="headerlink" title="2. dmesg | tail"></a>2. dmesg | tail</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">$ dmesg | tail</div><div class="line">[1880957.563150] perl invoked oom-killer: gfp_mask=0x280da, order=0, oom_score_adj=0</div><div class="line">[...]</div><div class="line">[1880957.563400] Out of memory: Kill process 18694 (perl) score 246 or sacrifice child</div><div class="line">[1880957.563408] Killed process 18694 (perl) total-vm:1972392kB, anon-rss:1953348kB, file-rss:0kB</div><div class="line">[2320864.954447] TCP: Possible SYN flooding on port 7001. Dropping request.  Check SNMP counters.</div></pre></td></tr></table></figure>
<p>이 명령어는 최근 10개의 시스템 메세지를 보여줍니다, 에러와 야기된 퍼포먼스의 이슈를 확인 할 수 있습니다.<br>예제에 oom-killer와 TCP drop이 발생한것이 보이네요.</p>
<p>이 스텝을 놓치지 마세요. dmesg는 항상 확인해야합니다.</p>
<h3 id="3-vmstat-1"><a href="#3-vmstat-1" class="headerlink" title="3. vmstat 1"></a>3. vmstat 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ vmstat 1</div><div class="line">procs ---------memory---------- ---swap-- -----io---- -system-- ------cpu-----</div><div class="line"> r  b swpd   free   buff  cache   si   so    bi    bo   <span class="keyword">in</span>   cs us sy id wa st</div><div class="line">34  0    0 200889792  73708 591828    0    0     0     5    6   10 96  1  3  0  0</div><div class="line">32  0    0 200889920  73708 591860    0    0     0   592 13284 4282 98  1  1  0  0</div><div class="line">32  0    0 200890112  73708 591860    0    0     0     0 9501 2154 99  1  0  0  0</div><div class="line">32  0    0 200889568  73712 591856    0    0     0    48 11900 2459 99  0  0  0  0</div><div class="line">32  0    0 200890208  73712 591860    0    0     0     0 15898 4840 98  1  1  0  0</div></pre></td></tr></table></figure>
<p>vmstat은 일반적으로 사용되는 툴입니다. (BSD에서 처음 만들어졌죠) 이것은 각 라인마다 통계치를 출력해줍니다.<br>vmstat에 argument를 1로 설정할 경우 1초마다의 평균 값을 출력합니다.</p>
<p>해당 출력 된 컬럼을 확인해봅시다.</p>
<ul>
<li><strong>r</strong> : CPU에서 실행되는 프로세스의 값입니다. 이것은 CPU 포화 상태를 판단하는데 있어서 Load 정보보다 더 좋은 정보를 제공합니다. 디스크 I/O는 포함되지 않습니다.</li>
<li><strong>free</strong> : Free 메모리 정보입니다.(kilobytes)</li>
<li><strong>si,so</strong> : Swap in, Swap out 정보를 출력합니다. 만약 0이 아니면, Out of memory 상태인 것입니다.</li>
<li><strong>us,sy,id,wa,st</strong> : 이것은 CPU 시간의 고장입니다? 모든 CPU들의 평균 값으로 각각 user time, system time (kernel), idle, wait I/O 그리고 stolen time을 표시합니다.</li>
</ul>
<p>System time은 I/O 프로세싱에 필수적입니다. 20%가 넘어가는 평균적인 시스템 시간은 아마도 커널이 현재 I/O 를 비효율적으로 사용한다는 것이겠죠.</p>
<h3 id="4-mpstat-P-ALL-1"><a href="#4-mpstat-P-ALL-1" class="headerlink" title="4. mpstat -P ALL 1"></a>4. mpstat -P ALL 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ mpstat -P ALL 1</div><div class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07/14/2015  _x86_64_ (32 CPU)</div><div class="line">07:38:49 PM  CPU   %usr  %nice   %sys %iowait   %irq  %soft  %steal  %guest  %gnice  %idle</div><div class="line">07:38:50 PM  all  98.47   0.00   0.75    0.00   0.00   0.00    0.00    0.00    0.00   0.78</div><div class="line">07:38:50 PM    0  96.04   0.00   2.97    0.00   0.00   0.00    0.00    0.00    0.00   0.99</div><div class="line">07:38:50 PM    1  97.00   0.00   1.00    0.00   0.00   0.00    0.00    0.00    0.00   2.00</div><div class="line">07:38:50 PM    2  98.00   0.00   1.00    0.00   0.00   0.00    0.00    0.00    0.00   1.00</div><div class="line">07:38:50 PM    3  96.97   0.00   0.00    0.00   0.00   0.00    0.00    0.00    0.00   3.03</div><div class="line">[...]</div></pre></td></tr></table></figure>
<p>이 커맨드는 CPU 시간을 표시해주며 우리는 상태의 불균형을 확인 할 수 있습니다.</p>
<h3 id="5-pidstat-1"><a href="#5-pidstat-1" class="headerlink" title="5. pidstat 1"></a>5. pidstat 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">$ pidstat 1</div><div class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07/14/2015    _x86_64_    (32 CPU)</div><div class="line">07:41:02 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</div><div class="line">07:41:03 PM     0         9    0.00    0.94    0.00    0.94     1  rcuos/0</div><div class="line">07:41:03 PM     0      4214    5.66    5.66    0.00   11.32    15  mesos-slave</div><div class="line">07:41:03 PM     0      4354    0.94    0.94    0.00    1.89     8  java</div><div class="line">07:41:03 PM     0      6521 1596.23    1.89    0.00 1598.11    27  java</div><div class="line">07:41:03 PM     0      6564 1571.70    7.55    0.00 1579.25    28  java</div><div class="line">07:41:03 PM 60004     60154    0.94    4.72    0.00    5.66     9  pidstat</div><div class="line">07:41:03 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command</div><div class="line">07:41:04 PM     0      4214    6.00    2.00    0.00    8.00    15  mesos-slave</div><div class="line">07:41:04 PM     0      6521 1590.00    1.00    0.00 1591.00    27  java</div><div class="line">07:41:04 PM     0      6564 1573.00   10.00    0.00 1583.00    28  java</div><div class="line">07:41:04 PM   108      6718    1.00    0.00    0.00    1.00     0  snmp-pass</div><div class="line">07:41:04 PM 60004     60154    1.00    4.00    0.00    5.00     9  pidstat</div></pre></td></tr></table></figure>
<p>이 커맨더는 top과 비슷한 작은 요약본과 같습니다. 하지만 스크린을 초기화시키는 것이아니라 지속적으로 출력을 합니다. 이 것은 시간이 지나면서의 패턴 변화를 파악하는데 있어서 유용합니다. 또한 기록이 가능하지요.</p>
<p>예제를 보면 2개의 자바 프로세스가 CPU의 부하를 유발하였습니다.</p>
<h3 id="6-iostat-xz-1"><a href="#6-iostat-xz-1" class="headerlink" title="6. iostat -xz 1"></a>6. iostat -xz 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ iostat -xz 1</div><div class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07/14/2015  _x86_64_ (32 CPU)</div><div class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</div><div class="line">          73.96    0.00    3.73    0.03    0.06   22.21</div><div class="line">Device:   rrqm/s   wrqm/s     r/s     w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await  svctm  %util</div><div class="line">xvda        0.00     0.23    0.21    0.18     4.52     2.08    34.37     0.00    9.98   13.80    5.42   2.44   0.09</div><div class="line">xvdb        0.01     0.00    1.02    8.94   127.97   598.53   145.79     0.00    0.43    1.78    0.28   0.25   0.25</div><div class="line">xvdc        0.01     0.00    1.02    8.86   127.79   595.94   146.50     0.00    0.45    1.82    0.30   0.27   0.26</div><div class="line">dm-0        0.00     0.00    0.69    2.32    10.47    31.69    28.01     0.01    3.23    0.71    3.98   0.13   0.04</div><div class="line">dm-1        0.00     0.00    0.00    0.94     0.01     3.78     8.00     0.33  345.84    0.04  346.81   0.01   0.00</div><div class="line">dm-2        0.00     0.00    0.09    0.07     1.35     0.36    22.50     0.00    2.55    0.23    5.62   1.78   0.03</div><div class="line">[...]</div></pre></td></tr></table></figure>
<p>이 커맨드는 블록 디바이스(disks)를 이해하는데 매우 좋은 툴입니다. 작업 부하량과 결과 퍼포먼스를 함께 보여줍니다.</p>
<ul>
<li><strong>r/s, w/s, rkB/s, wkB/s</strong> : 각 디바이스의 read, writes, read Kbyes 그리고 write Kbytes 값을 초단위로 보여줍니다.</li>
<li><strong>await</strong> : I/O의 평균값(milliseconds)을 보여줍니다. 이것은 어플리케이션의 시간을 표시하는데 큐에 적재된 시간과 대기시간도 포함되어 있습니다.</li>
<li><strong>avgqu-sz</strong> : 디바이스 평균 요청 값을 보여줍니다. 1보다 큰 값은 포화 상태의 증거입니다.</li>
<li><strong>%util</strong> : 디바이스 utilization입니다. 장치가 실행하고 있던 일의 두번째 시간을 보여줍니다. 60%이상의 값은 퍼포먼스가 낮은 상태임을 뜻합니다.</li>
</ul>
<h3 id="7-free-m"><a href="#7-free-m" class="headerlink" title="7. free -m"></a>7. free -m</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ free -m</div><div class="line">             total       used       free     shared    buffers     cached</div><div class="line">Mem:        245998      24545     221453         83         59        541</div><div class="line">-/+ buffers/cache:      23944     222053</div><div class="line">Swap:            0          0          0</div></pre></td></tr></table></figure>
<p>2개의 컬럼을 보여줍니다.</p>
<ul>
<li><strong>buffers</strong> : buffer cache로 블록 디바이스 I/O 사용.</li>
<li><strong>cached</strong> : page cache로 파일시스템에서의 사용.</li>
</ul>
<p>“-/+ buffers/cache”는 free 메모리 와 사용량에 대한 작은 혼란을 야기합니다. 리눅스는 캐싱된 free memory를 사용합니다. 하지만 어플리케이션이 필요로 할때 빠르게 반환할 수 있습니다. 그렇기에 캐싱된 메모리는 free memory 에 포함된다고 생각하면 됩니다.<br>자세한 내용은 <a href="http://www.linuxatemyram.com/" target="_blank" rel="external">linuxatemyram</a>을 확인하시기 바랍니다.</p>
<p>리눅스에서 ZFS를 사용할 경우 추가로 혼란을 야기합니다. ZFS는 자신의 파일 시스템 캐시를 free -m 컬럼에 반영하지 않습니다. 따라서 이것은 low memory로 보일 수 있습니다. 실제로는 정상이지만요 (표시가 되지 않으니)</p>
<h3 id="8-sar-n-DEV-1"><a href="#8-sar-n-DEV-1" class="headerlink" title="8. sar -n DEV 1"></a>8. sar -n DEV 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ sar -n DEV 1</div><div class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07/14/2015     _x86_64_    (32 CPU)</div><div class="line">12:16:48 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</div><div class="line">12:16:49 AM      eth0  18763.00   5032.00  20686.42    478.30      0.00      0.00      0.00      0.00</div><div class="line">12:16:49 AM        lo     14.00     14.00      1.36      1.36      0.00      0.00      0.00      0.00</div><div class="line">12:16:49 AM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</div><div class="line">12:16:49 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil</div><div class="line">12:16:50 AM      eth0  19763.00   5101.00  21999.10    482.56      0.00      0.00      0.00      0.00</div><div class="line">12:16:50 AM        lo     20.00     20.00      3.25      3.25      0.00      0.00      0.00      0.00</div><div class="line">12:16:50 AM   docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00</div></pre></td></tr></table></figure>
<p>네트워크 인터페이스 처리량을 확인합니다.</p>
<h3 id="9-sar-n-TCP-ETCP-1"><a href="#9-sar-n-TCP-ETCP-1" class="headerlink" title="9. sar -n TCP,ETCP 1"></a>9. sar -n TCP,ETCP 1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$ sar -n TCP,ETCP 1</div><div class="line">Linux 3.13.0-49-generic (titanclusters-xxxxx)  07/14/2015    _x86_64_    (32 CPU)</div><div class="line">12:17:19 AM  active/s passive/s    iseg/s    oseg/s</div><div class="line">12:17:20 AM      1.00      0.00  10233.00  18846.0</div><div class="line">12:17:19 AM  atmptf/s  estres/s retrans/s isegerr/s   orsts/s</div><div class="line">12:17:20 AM      0.00      0.00      0.00      0.00      0.00</div><div class="line">12:17:20 AM  active/s passive/s    iseg/s    oseg/s</div><div class="line">12:17:21 AM      1.00      0.00   8359.00   6039.00</div><div class="line">12:17:20 AM  atmptf/s  estres/s retrans/s isegerr/s   orsts/s</div><div class="line">12:17:21 AM      0.00      0.00      0.00      0.00      0.00</div></pre></td></tr></table></figure>
<p>TCP 메트릭스를 간략하게 보여줍니다.</p>
<ul>
<li><strong>active/s</strong> : 내부에서 시작된 TCP 커넥션/s 입니다. (e.g., via conneect())</li>
<li><strong>passive/s</strong> : 외부에서 시작된 TCP 커넥션/s 입니다. (e.g., via accept())</li>
<li><strong>retrans/s</strong> : TCP 재송신/s</li>
</ul>
<h3 id="10-top"><a href="#10-top" class="headerlink" title="10. top"></a>10. top</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">$ top</div><div class="line">top - 21:19:52 up 217 days,  2:55, 22 users,  load average: 3.67, 2.53, 2.22</div><div class="line">Tasks: 451 total,   1 running, 450 sleeping,   0 stopped,   0 zombie</div><div class="line">Cpu(s): 10.5%us,  3.8%sy,  0.0%ni, 85.1%id,  0.6%wa,  0.0%hi,  0.1%si,  0.0%st</div><div class="line">Mem:  16331432k total, 16149524k used,   181908k free,     5088k buffers</div><div class="line">Swap:  4194300k total,  4194300k used,        0k free,    74892k cached</div><div class="line">  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND</div><div class="line">   39 root      20   0     0    0    0 S  1.9  0.0  16:34.02 events/4</div><div class="line">   99 root      20   0     0    0    0 D  1.9  0.0  81:43.73 kswapd0</div><div class="line">14607 nobody    20   0  189m  13m 4532 D  1.9  0.1   0:00.16 sendtg_sshwatch</div><div class="line">15167 root      20   0 17348 1448  848 R  1.9  0.0   0:00.01 top</div><div class="line">25259 root      20   0  410m 7672  620 S  1.9  0.0 937:26.13 rsyslogd</div></pre></td></tr></table></figure>
<p>오늘은 여기까지입니다.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoanp.github.io/2016/12/04/runit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Yoan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Yoanp">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/04/runit/" itemprop="url">
                  runit
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-04T00:07:31+09:00">
                2016-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>runit이란, 유닉스 크로스 플랫폼에서 작동하는 서비스 관리 프로그램 입니다.<br>비슷한 종류로는 init, launchdm, systemd 등이 있습니다.</p>
<p>구동되는 플랫폼은 아래와 같지요.</p>
<ul>
<li>GNU/Linux</li>
<li>*BSD</li>
<li>MacOSX</li>
<li>Solaris</li>
</ul>
<p>서비스들이 runsv 의 child process로 실행이 되며, 관리를 받게 됩니다.<br>(runsv : 서비스 데몬의 신호, 서비스 컨트롤 및 관리를 담당.)<br>또한 sv를 이용하여 모니터링 되고 있는 서비스들을 관리 할 수 있습니다.</p>
<p>저는 runit을 1번 프로세스로 사용하지 않고(systemd를 사용하지요) 특정 프로세스의 감시 툴로써 nginx를 모니터링 하고 auto restart처리를 할 예정입니다.<br>runsvdir은 service 디렉토리를 감시하고 해당 프로세스를 관리합니다.</p>
<hr>
<h3 id="자-설치해봅시다"><a href="#자-설치해봅시다" class="headerlink" title="자 설치해봅시다 :-)"></a>자 설치해봅시다 :-)</h3><blockquote>
<p>기본 조건 : Centos7, <a href="https://packagecloud.io/imeyer/runit/install" target="_blank" rel="external">RPM설치</a></p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># quick install</span></div><div class="line">curl <span class="_">-s</span> https://packagecloud.io/install/repositories/imeyer/runit/script.rpm.sh | bash</div><div class="line">yum install runit -y</div></pre></td></tr></table></figure>
<hr>
<h5 id="nginx-run-파일-생성"><a href="#nginx-run-파일-생성" class="headerlink" title="nginx run 파일 생성"></a>nginx run 파일 생성</h5><p>runsvdir이 해당 프로세스를 run파일을 실행시키는 것으로 처리합니다.<br>제가 사용하는 run 파일을 보시지요.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">cat /usr/<span class="built_in">local</span>/nginx/run</div><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"><span class="built_in">exec</span> /usr/<span class="built_in">local</span>/nginx/sbin/nginx -c /usr/<span class="built_in">local</span>/nginx/conf/nginx.conf 2&gt;&amp;1</div></pre></td></tr></table></figure>
<h5 id="경로-연결"><a href="#경로-연결" class="headerlink" title="경로 연결"></a>경로 연결</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> /etc/service</div><div class="line">ln <span class="_">-s</span> /usr/<span class="built_in">local</span>/nginx .</div></pre></td></tr></table></figure>
<h5 id="확인"><a href="#확인" class="headerlink" title="확인"></a>확인</h5><p>프로세스가 정상적으로 구동되었음이 확인 됩니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pstree | grep runsv</div><div class="line">  |-runsvdir---runsv---nginx---13*[nginx]</div></pre></td></tr></table></figure>
<h5 id="sv-명령어"><a href="#sv-명령어" class="headerlink" title="sv 명령어"></a>sv 명령어</h5><p>man 페이지를 보면 자세히 나옵니다만, 우선 대표적인 옵션을 봅시다.</p>
<ul>
<li>status : 서비스의 현재 상태를 보여줍니다.</li>
<li>up (start) : 서비스를 구동시킵니다.</li>
<li>down (stop) : 서비스의 TERM 신호와 CONT 신호를 보냅니다.</li>
<li>reload : HUP</li>
</ul>
<p>오늘 포스트는 여기까지 입니다.</p>
<hr>
<h4 id="참고"><a href="#참고" class="headerlink" title="참고"></a>참고</h4><p><a href="http://smarden.org/runit" target="_blank" rel="external">공식홈페이지</a><br><a href="https://en.wikipedia.org/wiki/Runit" target="_blank" rel="external">Wikipedia</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  

          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Yoan" />
          <p class="site-author-name" itemprop="name">Yoan</p>
           
              <p class="site-description motion-element" itemprop="description">Grit</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">7</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/crosoie" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/crosoie" target="_blank" title="Twitter">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  Twitter
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yoan</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
